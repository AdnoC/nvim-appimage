# Default OS image is Ubuntu 12.04 LTS Precise on Travis-CI for linux
language: c

os:
  - linux

compiler:
  - gcc

env:
  - FEATURES=huge SRCDIR=vim/src
    "CONFOPT='--enable-perlinterp --enable-pythoninterp --enable-python3interp --enable-rubyinterp --enable-luainterp --prefix=/usr'"

# sudo required to build AppImage (does apparently enable FUSE extensions)
sudo: required

git:
  depth: 1

branches:
  except:
    - /^v[0-9]/

addons:
  apt:
    packages:
      - autoconf
      - libperl-dev
      - python-dev
      - python3-dev
      - liblua5.1-0-dev
      - lua5.1

before_install:
    # make sure to use default 1.9.3 ruby (switching sudo on, does add different ruby versions, GRR!)
  - rvm use 1.9.3 --install --binary --fuzzy

script:
  - NPROC=$(getconf _NPROCESSORS_ONLN)
  - (cd ${SRCDIR} && ./configure --with-features=$FEATURES $CONFOPT --enable-fail-if-missing &&  make -j$NPROC )
  - ${SRCDIR}/vim --version
  - make $SHADOWOPT $TEST

after_success:
  - bash -ex scripts/appimage.sh || true

# vim:set sts=2 sw=2 tw=0 et:
